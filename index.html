<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ultimation • Roblox Studio Systems</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet"/>
<style>
  :root {
    --bg: #0c0e14;
    --fg: #f2f2f2;
    --accent: #00f0ff;
    --glass: rgba(255,255,255,0.04);
    --glass-border: rgba(255,255,255,0.09);
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body {
    font-family:'Inter',sans-serif;
    background:var(--bg);
    color:var(--fg);
    overflow-x:hidden;
    min-height:100vh;
  }
  body::before {
    content:"";position:fixed;inset:0;z-index:-1;
    background:linear-gradient(135deg,#111c2f,#1d2c45,#103548);
    background-size:300% 300%;animation:bgMove 20s ease infinite;
  }
  @keyframes bgMove{0%{background-position:0 50%}50%{100% 50%}100%{0 50%}}
  nav{position:fixed;top:0;left:0;width:100%;padding:14px 5vw;
    background:rgba(255,255,255,0.02);backdrop-filter:blur(12px);
    border-bottom:1px solid var(--glass-border);
    display:flex;justify-content:space-between;align-items:center;
    z-index:1000;
  }
  nav .logo{color:var(--accent);font-weight:800;font-size:1.3rem;cursor:default;}
  nav .links a{
    margin:0 12px;font-weight:600;color:var(--fg);text-decoration:none;cursor:pointer;
  }
  nav .links a:hover{color:var(--accent);}
  nav .user{color:var(--accent);font-weight:600;}
  main{padding-top:72px;}
  section{min-height:100vh;padding:80px 5vw;display:flex;justify-content:center;align-items:center;flex-direction:column;}
  .glass-box{
    background:var(--glass);border:1px solid var(--glass-border);
    backdrop-filter:blur(10px);border-radius:14px;padding:2rem;
    width:100%;max-width:600px;box-shadow:0 0 20px var(--accent);
    text-align:center;
  }
  h1,h2{color:var(--accent);margin-bottom:1rem;text-shadow:0 0 8px var(--accent);}
  p{margin-bottom:1.2rem;}
  input,button,textarea,select{
    width:100%;margin:8px 0;padding:12px 14px;
    border:none;border-radius:8px;font-size:1rem;
  }
  button{
    background:var(--accent);color:black;font-weight:700;cursor:pointer;border-radius:999px;
  }
  button:hover{background:#00c6d6;}
  textarea{
    height:200px;background:#111;color:#0ff;font-family:monospace;resize:none;margin-top:12px;
  }
  table{width:100%;border-collapse:collapse;margin-top:1rem;}
  table th,td{border:1px solid var(--glass-border);padding:12px;}
  table th{background:rgba(0,255,255,0.15);}
</style>
</head>
<body>

<nav>
  <div class="logo">Ultimation</div>
  <div class="links" id="navLinks">
    <a data-target="home">Home</a>
    <a data-target="dashboard" style="display:none;">Dashboard</a>
    <a data-target="admin" style="display:none;">Admin Panel</a>
    <a href="logout.html">Logout</a>
  </div>
  <div class="user" id="navUser"></div>
</nav>

<main>
  <!-- HOME -->
  <section id="home">
    <div class="glass-box">
      <h1>Ultimation</h1>
      <p>Roblox infrastructure for elite studios—real-time analytics, webhook tracking, game events, economy exports, and more.</p>
      <button id="btnLogin">Login / Signup</button>
      <div style="margin-top:2rem;text-align:left;">
        <h2>Features</h2>
        <ul style="list-style:none;text-align:left;padding-left:1.2rem;">
          <li>• Real-time player & server tracking</li>
          <li>• Customizable Discord webhooks</li>
          <li>• Secure API token + Lua script download</li>
          <li>• Heartbeat & event logging</li>
          <li>• PRC tools: ban sync, chat report, economy CSV</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- AUTH -->
  <section id="auth" style="display:none;">
    <div class="glass-box">
      <h2 id="authTitle">Login</h2>
      <input id="authEmail" type="email" placeholder="Email">
      <input id="authPass" type="password" placeholder="Password">
      <button id="authSubmit">Continue</button>
      <p><span id="authSwitchText">Don't have an account?</span> 
         <a id="authSwitch" style="color:var(--accent);cursor:pointer;">Sign up</a></p>
    </div>
  </section>
    <!-- DASHBOARD -->
  <section id="dashboard" style="display:none;">
    <div class="glass-box">
      <h2>Dashboard</h2>
      <p>Hello, <span id="userEmail"></span>
        <button id="logoutBtn" style="margin-left:12px;background:transparent;border:1px solid var(--accent);color:var(--accent);padding:8px 14px;border-radius:999px;">Logout</button>
      </p>
      <div style="text-align:left;margin-top:1rem;">
        <strong>Stats:</strong><br>
        Heartbeats: <span id="statHeartbeats">0</span> • Joins: <span id="statJoins">0</span> • Leaves: <span id="statLeaves">0</span>
      </div>
      <hr style="margin:1rem 0;">
      <h3>Webhook Integration</h3>
      <label>Your Discord Webhook URL</label>
      <input id="webhookUrl" placeholder="https://discord.com/api/webhooks/…">
      <button id="generateLuaBtn">Generate + Download Lua</button>
      <textarea id="luaOutput" readonly></textarea>
      <hr style="margin:1rem 0;">
      <div style="text-align:left;">
        <strong>API Token:</strong><br><span id="apiTokenDisplay" style="font-family:monospace;"></span><br>
        <button id="regenTokenBtn" style="background:#f55;">Regenerate Token</button>
      </div>
    </div>
  </section>

  <!-- ADMIN -->
  <section id="admin" style="display:none;">
    <div class="glass-box">
      <h2>Admin Panel</h2>
      <table>
        <thead><tr><th>Email</th><th>Token</th><th>Heartbeats</th><th>Joins</th><th>Leaves</th><th>Action</th></tr></thead>
        <tbody id="adminTable"></tbody>
      </table>
      <button id="adminLogoutBtn" style="margin-top:1rem;">Logout Admin</button>
    </div>
  </section>
</main>

<script>
  // Storage keys and admin credentials
  const USERS_KEY = "ultimation_users";
  const SESSION_KEY = "ultimation_current";
  const ADMIN_EMAIL = "admin@ultimation.com";
  const ADMIN_PASS = "StrongAdminPass123!";

  const users = JSON.parse(localStorage.getItem(USERS_KEY) || "{}");
  let current = sessionStorage.getItem(SESSION_KEY);
  let user = current ? users[current] : null;

  const navLinks = document.querySelectorAll(".links a");
  const navUser = document.getElementById("navUser");

  function save(){ localStorage.setItem(USERS_KEY, JSON.stringify(users)); }

  // Login/signup logic
  let authMode = "login";
  const switchAuth = () => {
    authMode = authMode === "login" ? "signup" : "login";
    document.getElementById("authTitle").innerText = authMode==="login"?"Login":"Sign Up";
    document.getElementById("authSwitchText").innerText = authMode==="login"?"Don't have an account?":"Already have an account?";
    document.getElementById("authSwitch").innerText = authMode==="login"?"Sign up":"Login";
  };
  document.getElementById("btnLogin").onclick = () => show("auth");
  document.getElementById("authSwitch").onclick = switchAuth;
  document.getElementById("authSubmit").onclick = () => {
    const email = document.getElementById("authEmail").value.trim().toLowerCase();
    const pass = document.getElementById("authPass").value.trim();
    if (!email.includes("@") || pass.length < 6) return alert("Invalid credentials.");
    if (authMode === "login") {
      if (email === ADMIN_EMAIL && pass === ADMIN_PASS) {
        sessionStorage.setItem(SESSION_KEY, email);
        show("admin"); loadAdmin(); return;
      }
      if (!users[email] || users[email].pass !== pass) return alert("Login failed.");
      sessionStorage.setItem(SESSION_KEY, email);
      current = email; user = users[email];
      user.heartbeats = user.heartbeats || 0;
      user.joins = user.joins || 0;
      user.leaves = user.leaves || 0;
      save();
      show("dashboard"); loadDashboard();
    } else {
      if (users[email]) return alert("Account exists.");
      users[email] = { pass, apiToken: generateToken(), heartbeats:0, joins:0, leaves:0, webhook:"" };
      save();
      alert("Account created! Now log in.");
      switchAuth();
    }
  };

  function generateToken() {
    const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
    return Array(32).fill().map(() => chars.charAt(Math.floor(Math.random()*chars.length))).join("");
  }

  function show(sec) {
    ["home","auth","dashboard","admin"].forEach(s => {
      document.getElementById(s).style.display = s===sec? "flex":"none";
    });
    navLinks.forEach(l => {
      l.style.display = (l.dataset.target===sec || (sec==="home" && l.dataset.target==="home")) ? "inline" : "none";
    });
    navUser.textContent = current ? (current===ADMIN_EMAIL?"Admin":" "+current) : "";
  }
    // DASHBOARD
  function loadDashboard() {
    document.getElementById("userEmail").textContent = current;
    document.getElementById("statHeartbeats").textContent = user.heartbeats || 0;
    document.getElementById("statJoins").textContent = user.joins || 0;
    document.getElementById("statLeaves").textContent = user.leaves || 0;
    document.getElementById("webhookUrl").value = user.webhook || "";
    document.getElementById("apiTokenDisplay").textContent = user.apiToken;

    document.getElementById("generateLuaBtn").onclick = () => {
      user.webhook = document.getElementById("webhookUrl").value;
      save();
      const lua = `
local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")

local API_URL = "https://your-backend.com/track"
local API_TOKEN = "${user.apiToken}"

local function send(data)
    local success, err = pcall(function()
        HttpService:PostAsync(API_URL, HttpService:JSONEncode({
            apiToken = API_TOKEN,
            placeId = game.PlaceId,
            eventType = data.eventType,
            player = data.player or "",
            extra = data.extra or ""
        }), Enum.HttpContentType.ApplicationJson)
    end)
    if not success then warn("Tracking failed", err) end
end

Players.PlayerAdded:Connect(function(plr)
    send({eventType="PlayerAdded", player=plr.Name})
end)

Players.PlayerRemoving:Connect(function(plr)
    send({eventType="PlayerRemoving", player=plr.Name})
end)

while true do
    send({eventType="heartbeat"})
    wait(60)
end
      `.trim();
      document.getElementById("luaOutput").value = lua;

      const blob = new Blob([lua], { type: "text/plain" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "UltimationTracker.lua";
      a.click();
    };

    document.getElementById("regenTokenBtn").onclick = () => {
      user.apiToken = generateToken();
      document.getElementById("apiTokenDisplay").textContent = user.apiToken;
      save();
      alert("New token generated. Download the new Lua script.");
    };

    document.getElementById("logoutBtn").onclick = () => {
      sessionStorage.removeItem(SESSION_KEY);
      location.href = "logout.html";
    };
  }

  // ADMIN PANEL
  function loadAdmin() {
    const tbody = document.getElementById("adminTable");
    tbody.innerHTML = "";
    Object.entries(users).forEach(([email, u]) => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${email}</td>
        <td>${u.apiToken || "n/a"}</td>
        <td>${u.heartbeats || 0}</td>
        <td>${u.joins || 0}</td>
        <td>${u.leaves || 0}</td>
        <td><button onclick="deleteUser('${email}')">🗑</button></td>
      `;
      tbody.appendChild(row);
    });
    document.getElementById("adminLogoutBtn").onclick = () => {
      sessionStorage.removeItem(SESSION_KEY);
      location.href = "logout.html";
    };
  }

  window.deleteUser = (email) => {
    if (confirm("Delete user " + email + "?")) {
      delete users[email];
      save();
      loadAdmin();
    }
  };

  // Load session if exists
  if (current) {
    if (current === ADMIN_EMAIL) {
      show("admin");
      loadAdmin();
    } else if (users[current]) {
      user = users[current];
      show("dashboard");
      loadDashboard();
    }
  } else {
    show("home");
  }

  // Scroll nav links
  navLinks.forEach(l => {
    l.onclick = () => {
      const sec = l.dataset.target;
      show(sec);
      if (sec === "dashboard") loadDashboard();
      if (sec === "admin") loadAdmin();
    };
  });

  // Auto logout on tab close
  window.addEventListener("beforeunload", () => {
    sessionStorage.removeItem(SESSION_KEY);
  });
</script>
</body>
</html>
